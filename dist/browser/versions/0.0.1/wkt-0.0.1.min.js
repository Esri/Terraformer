(function(e,t){typeof module=="object"&&typeof module.exports=="object"?(Terraformer=require("terraformer"),exports=module.exports=t()):typeof define=="function"&&define.amd?define(t):(typeof e.Terraformer=="undefined"&&(e.Terraformer={}),e.Terraformer.WKT=t()),typeof jasmine=="object"&&typeof Terraformer===undefined&&(e.Terraformer={})})(this,function(){function n(e){this.data=[e],this.type="PointArray"}function r(e){this.data=e,this.type="Ring"}function i(e){this.data=[e],this.type="RingList"}function s(e){this.data=[e],this.type="PolygonList"}function o(){return t.parse.apply(t,arguments)}function u(e){var n,r;try{n=t.parse(e)}catch(i){throw Error("Unable to parse",i)}return Terraformer.Primitive(n)}var e={},t=function(){function o(){this.yy={}}var e={trace:function(){},yy:{},symbols_:{error:2,expressions:3,point:4,EOF:5,linestring:6,polygon:7,multipoint:8,multilinestring:9,multipolygon:10,coordinate:11,DOUBLE_TOK:12,ptarray:13,COMMA:14,ring_list:15,ring:16,"(":17,")":18,POINT:19,point_untagged:20,polygon_list:21,polygon_untagged:22,point_list:23,LINESTRING:24,POLYGON:25,MULTIPOINT:26,MULTILINESTRING:27,MULTIPOLYGON:28,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",12:"DOUBLE_TOK",14:"COMMA",17:"(",18:")",19:"POINT",24:"LINESTRING",25:"POLYGON",26:"MULTIPOINT",27:"MULTILINESTRING",28:"MULTIPOLYGON"},productions_:[0,[3,2],[3,2],[3,2],[3,2],[3,2],[3,2],[11,2],[11,3],[11,4],[13,3],[13,1],[15,3],[15,1],[16,3],[4,4],[20,1],[20,3],[21,3],[21,1],[22,3],[23,3],[23,1],[6,4],[7,4],[8,4],[9,4],[10,4]],performAction:function(t,o,u,a,f,l,c){var h=l.length-1;switch(f){case 1:return{type:"Point",coordinates:l[h-1].data[0]};case 2:return{type:"LineString",coordinates:l[h-1].data};case 3:return{type:"Polygon",coordinates:l[h-1].toJSON()};case 4:return{type:"MultiPoint",coordinates:l[h-1].data};case 5:return{type:"MultiLineString",coordinates:l[h-1].toJSON()};case 6:return{type:"MultiPolygon",coordinates:l[h-1].toJSON()};case 7:this.$=new n([Number(l[h-1]),Number(l[h])]);break;case 8:this.$=new n([Number(l[h-2]),Number(l[h-1]),Number(l[h])]);break;case 9:this.$=new n([Number(l[h-3]),Number(l[h-2]),Number(l[h-1]),Number(l[h])]);break;case 10:this.$=l[h-2].addPoint(l[h]);break;case 11:this.$=l[h];break;case 12:this.$=l[h-2].addRing(l[h]);break;case 13:this.$=new i(l[h]);break;case 14:this.$=new r(l[h-1]);break;case 15:this.$=l[h-1];break;case 16:this.$=l[h];break;case 17:this.$=l[h-1];break;case 18:this.$=l[h-2].addPolygon(l[h]);break;case 19:this.$=new s(l[h]);break;case 20:this.$=l[h-1];break;case 21:this.$=l[h-2].addPoint(l[h]);break;case 22:this.$=l[h];break;case 23:this.$=l[h-1];break;case 24:this.$=l[h-1];break;case 25:this.$=l[h-1];break;case 26:this.$=l[h-1];break;case 27:this.$=l[h-1]}},table:[{3:1,4:2,6:3,7:4,8:5,9:6,10:7,19:[1,8],24:[1,9],25:[1,10],26:[1,11],27:[1,12],28:[1,13]},{1:[3]},{5:[1,14]},{5:[1,15]},{5:[1,16]},{5:[1,17]},{5:[1,18]},{5:[1,19]},{17:[1,20]},{17:[1,21]},{17:[1,22]},{17:[1,23]},{17:[1,24]},{17:[1,25]},{1:[2,1]},{1:[2,2]},{1:[2,3]},{1:[2,4]},{1:[2,5]},{1:[2,6]},{11:27,12:[1,28],13:26},{11:31,12:[1,28],17:[1,32],20:30,23:29},{15:33,16:34,17:[1,35]},{11:31,12:[1,28],17:[1,32],20:30,23:36},{15:37,16:34,17:[1,35]},{17:[1,40],21:38,22:39},{14:[1,42],18:[1,41]},{14:[2,11],18:[2,11]},{12:[1,43]},{14:[1,45],18:[1,44]},{14:[2,22],18:[2,22]},{14:[2,16],18:[2,16]},{11:46,12:[1,28]},{14:[1,48],18:[1,47]},{14:[2,13],18:[2,13]},{11:27,12:[1,28],13:49},{14:[1,45],18:[1,50]},{14:[1,48],18:[1,51]},{14:[1,53],18:[1,52]},{14:[2,19],18:[2,19]},{15:54,16:34,17:[1,35]},{5:[2,15]},{11:55,12:[1,28]},{12:[1,56],14:[2,7],18:[2,7]},{5:[2,23]},{11:31,12:[1,28],17:[1,32],20:57},{18:[1,58]},{5:[2,24]},{16:59,17:[1,35]},{14:[1,42],18:[1,60]},{5:[2,25]},{5:[2,26]},{5:[2,27]},{17:[1,40],22:61},{14:[1,48],18:[1,62]},{14:[2,10],18:[2,10]},{12:[1,63],14:[2,8],18:[2,8]},{14:[2,21],18:[2,21]},{14:[2,17],18:[2,17]},{14:[2,12],18:[2,12]},{14:[2,14],18:[2,14]},{14:[2,18],18:[2,18]},{14:[2,20],18:[2,20]},{14:[2,9],18:[2,9]}],defaultActions:{14:[2,1],15:[2,2],16:[2,3],17:[2,4],18:[2,5],19:[2,6],41:[2,15],44:[2,23],47:[2,24],50:[2,25],51:[2,26],52:[2,27]},parseError:function(t,n){throw new Error(t)},parse:function(t){function v(e){r.length=r.length-2*e,i.length=i.length-e,s.length=s.length-e}function m(){var e;return e=n.lexer.lex()||1,typeof e!="number"&&(e=n.symbols_[e]||e),e}var n=this,r=[0],i=[null],s=[],o=this.table,u="",a=0,f=0,l=0,c=2,h=1;this.lexer.setInput(t),this.lexer.yy=this.yy,this.yy.lexer=this.lexer,this.yy.parser=this,typeof this.lexer.yylloc=="undefined"&&(this.lexer.yylloc={});var p=this.lexer.yylloc;s.push(p);var d=this.lexer.options&&this.lexer.options.ranges;typeof this.yy.parseError=="function"&&(this.parseError=this.yy.parseError);var g,y,b,w,E,S,x={},T,N,C,k;for(;;){b=r[r.length-1];if(this.defaultActions[b])w=this.defaultActions[b];else{if(g===null||typeof g=="undefined")g=m();w=o[b]&&o[b][g]}if(typeof w=="undefined"||!w.length||!w[0]){var L="";if(!l){k=[];for(T in o[b])this.terminals_[T]&&T>2&&k.push("'"+this.terminals_[T]+"'");this.lexer.showPosition?L="Parse error on line "+(a+1)+":\n"+this.lexer.showPosition()+"\nExpecting "+k.join(", ")+", got '"+(this.terminals_[g]||g)+"'":L="Parse error on line "+(a+1)+": Unexpected "+(g==1?"end of input":"'"+(this.terminals_[g]||g)+"'"),this.parseError(L,{text:this.lexer.match,token:this.terminals_[g]||g,line:this.lexer.yylineno,loc:p,expected:k})}}if(w[0]instanceof Array&&w.length>1)throw new Error("Parse Error: multiple actions possible at state: "+b+", token: "+g);switch(w[0]){case 1:r.push(g),i.push(this.lexer.yytext),s.push(this.lexer.yylloc),r.push(w[1]),g=null,y?(g=y,y=null):(f=this.lexer.yyleng,u=this.lexer.yytext,a=this.lexer.yylineno,p=this.lexer.yylloc,l>0&&l--);break;case 2:N=this.productions_[w[1]][1],x.$=i[i.length-N],x._$={first_line:s[s.length-(N||1)].first_line,last_line:s[s.length-1].last_line,first_column:s[s.length-(N||1)].first_column,last_column:s[s.length-1].last_column},d&&(x._$.range=[s[s.length-(N||1)].range[0],s[s.length-1].range[1]]),S=this.performAction.call(x,u,f,a,this.yy,w[1],i,s);if(typeof S!="undefined")return S;N&&(r=r.slice(0,-1*N*2),i=i.slice(0,-1*N),s=s.slice(0,-1*N)),r.push(this.productions_[w[1]][0]),i.push(x.$),s.push(x._$),C=o[r[r.length-2]][r[r.length-1]],r.push(C);break;case 3:return!0}}return!0}};undefined;var t=function(){var e={EOF:1,parseError:function(t,n){if(!this.yy.parser)throw new Error(t);this.yy.parser.parseError(t,n)},setInput:function(e){return this._input=e,this._more=this._less=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var e=this._input[0];this.yytext+=e,this.yyleng++,this.offset++,this.match+=e,this.matched+=e;var t=e.match(/(?:\r\n?|\n).*/g);return t?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),e},unput:function(e){var t=e.length,n=e.split(/(?:\r\n?|\n)/g);this._input=e+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-t-1),this.offset-=t;var r=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),n.length-1&&(this.yylineno-=n.length-1);var i=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:n?(n.length===r.length?this.yylloc.first_column:0)+r[r.length-n.length].length-n[0].length:this.yylloc.first_column-t},this.options.ranges&&(this.yylloc.range=[i[0],i[0]+this.yyleng-t]),this},more:function(){return this._more=!0,this},less:function(e){this.unput(this.match.slice(e))},pastInput:function(){var e=this.matched.substr(0,this.matched.length-this.match.length);return(e.length>20?"...":"")+e.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var e=this.match;return e.length<20&&(e+=this._input.substr(0,20-e.length)),(e.substr(0,20)+(e.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var e=this.pastInput(),t=(new Array(e.length+1)).join("-");return e+this.upcomingInput()+"\n"+t+"^"},next:function(){if(this.done)return this.EOF;this._input||(this.done=!0);var e,t,n,r,i,s;this._more||(this.yytext="",this.match="");var o=this._currentRules();for(var u=0;u<o.length;u++){n=this._input.match(this.rules[o[u]]);if(n&&(!t||n[0].length>t[0].length)){t=n,r=u;if(!this.options.flex)break}}if(t){s=t[0].match(/(?:\r\n?|\n).*/g),s&&(this.yylineno+=s.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:s?s[s.length-1].length-s[s.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+t[0].length},this.yytext+=t[0],this.match+=t[0],this.matches=t,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._input=this._input.slice(t[0].length),this.matched+=t[0],e=this.performAction.call(this,this.yy,this,o[r],this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1);if(e)return e;return}return this._input===""?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var t=this.next();return typeof t!="undefined"?t:this.lex()},begin:function(t){this.conditionStack.push(t)},popState:function(){return this.conditionStack.pop()},_currentRules:function(){return this.conditions[this.conditionStack[this.conditionStack.length-1]].rules},topState:function(){return this.conditionStack[this.conditionStack.length-2]},pushState:function(t){this.begin(t)}};return e.options={},e.performAction=function(t,n,r,i){var s=i;switch(r){case 0:break;case 1:return 17;case 2:return 18;case 3:return 12;case 4:return 19;case 5:return 24;case 6:return 25;case 7:return 26;case 8:return 27;case 9:return 28;case 10:return 14;case 11:return 5;case 12:return"INVALID"}},e.rules=[/^(?:\s+)/,/^(?:\()/,/^(?:\))/,/^(?:-?(([0-9]+\.?)|([0-9]*\.?[0-9]+)([eE][-+]?[0-9]+)?))/,/^(?:POINT\b)/,/^(?:LINESTRING\b)/,/^(?:POLYGON\b)/,/^(?:MULTIPOINT\b)/,/^(?:MULTILINESTRING\b)/,/^(?:MULTIPOLYGON\b)/,/^(?:,)/,/^(?:$)/,/^(?:.)/],e.conditions={INITIAL:{rules:[0,1,2,3,4,5,6,7,8,9,10,11,12],inclusive:!0}},e}();return e.lexer=t,o.prototype=e,e.Parser=o,new o}();return n.prototype.addPoint=function(e){return e.type==="PointArray"?this.data=this.data.concat(e.data):this.data.push(e),this},n.prototype.toJSON=function(){return this.data},r.prototype.toJSON=function(){var e=[];for(var t=0;t<this.data.data.length;t++)e.push(this.data.data[t]);return e},i.prototype.addRing=function(e){return this.data.push(e),this},i.prototype.toJSON=function(){var e=[];for(var t=0;t<this.data.length;t++)e.push(this.data[t].toJSON());return e.length===1?e:e},s.prototype.addPolygon=function(e){return this.data.push(e),this},s.prototype.toJSON=function(){var e=[];for(var t=0;t<this.data.length;t++)e=e.concat([this.data[t].toJSON()]);return e.length===1?e:e},e.parser=t,e.Parser=t.Parser,e.parse=u,e});