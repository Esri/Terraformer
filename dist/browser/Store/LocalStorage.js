(function(e,t){typeof define=="function"&&define.amd&&define([],t),typeof e.navigator=="object"&&(typeof e.Terraformer=="undefined"&&(e.Terraformer={}),typeof e.Terraformer.Store=="undefined"&&(e.Terraformer.Store={}),e.Terraformer.Store.LocalStorage=t().LocalStorage)})(this,function(){function t(){var e=arguments[0]||{};this._key=e.key||"_terraformer"}var e={};return arguments[0]&&typeof define=="function"&&define.amd&&(this.Terraformer=arguments[0]),t.prototype.add=function(e,t){if(e.type==="FeatureCollection")for(var n=0;n<e.features.length;n++)this.set(e.features[n]);else this.set(e);return t.resolve(e),t},t.prototype.key=function(e){return this._key+"_"+e},t.prototype.remove=function(e,t){return localStorage.removeItem(this.key(e)),t.resolve(),t},t.prototype.get=function(e,t){return t.resolve(JSON.parse(localStorage.getItem(this.key(e)))),t},t.prototype.set=function(e){localStorage.setItem(this.key(e.id),JSON.stringify(e))},t.prototype.update=function(e,t){return this.set(e),t.resolve(e),t},t.prototype.toJSON=function(){var e=new RegExp("^"+this._key),t={};for(var n in localStorage)n.match(e)&&(t[n]=localStorage[n]);return t},t.prototype.serialize=function(e){var t=[],n=new this.deferred;e&&n.then(function(t){e(null,t)},function(t){e(t,null)});for(var r in localStorage)r.match(this.key)&&t.push(localStorage.getItem(r));n.resolve(JSON.stringify(t));return},t.prototype.deserialize=function(e,t){var n=JSON.parse(e),r=new this.deferred;t&&r.then(function(e){t(null,e)},function(e){t(e,null)});for(var i=n.length-1;i>=0;i--)this.set(n[i]);return r.resolve(this),r},e.LocalStorage=t,e});