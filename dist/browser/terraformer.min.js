(function(e,t){typeof module=="object"&&typeof module.exports=="object"?exports=module.exports=t():typeof define=="function"&&define.amd?define(t):e.Terraformer=t(),typeof jasmine=="object"&&(typeof Terraformer===undefined&&(e.Terraformer={}),e.Terraformer=t())})(this,function(){function o(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e}function u(e,t){t=t||{};var n=Object.keys(t);for(var r in n)e[n[r]]=t[n[r]];return e}function a(e){switch(e.type){case"Point":return[e.coordinates[0],e.coordinates[1],e.coordinates[0],e.coordinates[1]];case"MultiPoint":return l(e.coordinates);case"LineString":return l(e.coordinates);case"MultiLineString":return f(e.coordinates);case"Polygon":return l(e.coordinates[0]);case"MultiPolygon":return f(e.coordinates);case"Feature":return a(e.geometry);case"FeatureCollection":return c(e);case"GeometryCollection":return h(e);default:throw new Error("Unknown type: "+e.type)}}function f(e){var t=[],n;for(var r=e.length-1;r>=0;r--)typeof e[r][0]=="number"?(n=l(e),t.push([n[0],n[1]]),t.push([n[2],n[3]])):typeof e[r][0]=="object"&&(n=f(e[r]),t.push([n[0],n[1]]),t.push([n[2],n[3]]));return l(t)}function l(e){var t,n,r,i;for(var s=e.length-1;s>=0;s--){var o=e[s],u=o[0],a=o[1];t===undefined?t=u:u<t&&(t=u),r===undefined?r=a:a<r&&(r=a),n===undefined?n=u:u>n&&(n=u),i===undefined?i=a:a>i&&(i=a)}return[t,r,n,i]}function c(e){var t=[],n;for(var r=e.features.length-1;r>=0;r--)n=a(e.features[r].geometry),t.push([n[0],n[1]]),t.push([n[2],n[3]]);return l(t)}function h(e){var t=[],n;for(var r=e.geometries.length-1;r>=0;r--)n=a(e.geometries[r]),t.push([n[0],n[1]]),t.push([n[2],n[3]]);return l(t)}function p(e){return e*n}function d(e){return e*r}function v(e,t){for(var n=0;n<e.geometries.length;n++)e.geometries[n].geometry=g(e.features[n].geometry,t);return e}function m(e,t){for(var n=0;n<e.features.length;n++)e.features[n].geometry=g(e.features[n].geometry,t);return e}function g(e,t){for(var n=0;n<e.length;n++)typeof e[n][0]=="number"&&(e[n]=t(e[n])),typeof e[n]=="object"&&(e[n]=g(e[n],t));return e}function y(e){var n=e[0],r=e[1];return[p(n/t)-Math.floor((p(n/t)+180)/360)*360,p(Math.PI/2-2*Math.atan(Math.exp(-1*r/t)))]}function b(e){var n=e[0],r=Math.max(Math.min(e[1],89.99999),-89.99999);return[d(n)*t,t/2*Math.log((1+Math.sin(d(r)))/(1-Math.sin(d(r))))]}function w(e,t){return e.type==="Point"?e.coordinates=t(e.coordinates):e.type==="Feature"?e.geometry=w(e,t):e.type==="FeatureCollection"?e.features=m(e,t):e.type==="GeometryCollection"?e.geometries=v(e,t):e.coordinates=g(e.coordinates,t),t===b&&(e.crs=i),t===y&&delete e.crs,e}function E(e){return w(e,b)}function S(e){return w(e,y)}function T(e){if(e)switch(e.type){case"Point":return new N(e);case"MultiPoint":return new C(e);case"LineString":return new k(e);case"MultiLineString":return new L(e);case"Polygon":return new A(e);case"MultiPolygon":return new O(e);case"Feature":return new M(e);case"FeatureCollection":return new _(e);case"GeometryCollection":return new D(e);default:throw new Error("Unknown type: "+e.type)}}function N(e){var t=Array.prototype.slice.call(arguments);if(e&&e.type==="Point"&&e.coordinates)o(this,e);else if(e&&Array.isArray(e))this.type="Point",this.coordinates=e;else if(t.length>=2)this.type="Point",this.coordinates=t;else{if(!!t.length)throw"Terraformer: invalid input for Terraformer.Point";this.type="Point"}this.__defineGetter__("bbox",function(){return a(this)})}function C(e){if(e&&e.type==="MultiPoint"&&e.coordinates)o(this,e);else if(Array.isArray(e))this.type="MultiPoint",this.coordinates=e;else{if(!!e)throw"Terraformer: invalid input for Terraformer.MultiPoint";this.type="MultiPoint"}this.__defineGetter__("bbox",function(){return a(this)}),this.__defineGetter__("length",function(){return this.coordinates?this.coordinates.length:0})}function k(e){if(e&&e.type==="LineString"&&e.coordinates)o(this,e);else if(Array.isArray(e))this.type="LineString",this.coordinates=e;else{if(!!e)throw"Terraformer: invalid input for Terraformer.LineString";this.type="LineString"}this.__defineGetter__("bbox",function(){return a(this)})}function L(e){if(e&&e.type==="MultiLineString"&&e.coordinates)o(this,e);else if(Array.isArray(e))this.type="MultiLineString",this.coordinates=e;else{if(!!e)throw"Terraformer: invalid input for Terraformer.MultiLineString";this.type="MultiLineString"}this.__defineGetter__("bbox",function(){return a(this)}),this.__defineGetter__("length",function(){return this.coordinates?this.coordinates.length:0})}function A(e){if(e&&e.type==="Polygon"&&e.coordinates)o(this,e);else if(Array.isArray(e))this.type="Polygon",this.coordinates=e;else{if(!!e)throw"Terraformer: invalid input for Terraformer.Polygon";this.type="Polygon"}this.__defineGetter__("bbox",function(){return a(this)})}function O(e){if(e&&e.type==="MultiPolygon"&&e.coordinates)o(this,e);else if(Array.isArray(e))this.type="MultiPolygon",this.coordinates=e;else{if(!!e)throw"Terraformer: invalid input for Terraformer.MultiPolygon";this.type="MultiPolygon"}this.__defineGetter__("bbox",function(){return a(this)}),this.__defineGetter__("length",function(){return this.coordinates?this.coordinates.length:0})}function M(e){if(e&&e.type==="Feature"&&e.geometry)o(this,e);else if(e&&e.type&&e.coordinates)this.type="Feature",this.geometry=e;else{if(!!e)throw"Terraformer: invalid input for Terraformer.Feature";this.type="Feature"}this.__defineGetter__("bbox",function(){return a(this)})}function _(e){if(e&&e.type==="FeatureCollection"&&e.features)o(this,e);else if(Array.isArray(e))this.type="FeatureCollection",this.features=e;else{if(!!e)throw"Terraformer: invalid input for Terraformer.FeatureCollection";this.type="FeatureCollection"}this.__defineGetter__("length",function(){return this.features?this.features.length:0}),this.__defineGetter__("bbox",function(){return a(this)})}function D(e){if(e&&e.type==="GeometryCollection"&&e.geometries)o(this,e);else if(Array.isArray(e))this.type="GeometryCollection",this.geometries=e;else if(e.coordinates&&e.type)this.type="GeometryCollection",this.geometries=[e];else{if(!!e)throw"Terraformer: invalid input for Terraformer.GeometryCollection";this.type="GeometryCollection"}this.__defineGetter__("length",function(){return this.geometries?this.geometries.length:0}),this.__defineGetter__("bbox",function(){return a(this)})}function P(e,t,n){var r=b(e),i=n||64,s=t||250,o={type:"Polygon",coordinates:[[]]};for(var u=1;u<=i;u++){var a=u*(360/i)*Math.PI/180;o.coordinates[0].push([r[0]+s*Math.cos(a),r[1]+s*Math.sin(a)])}return S(o)}function H(e,t,n){var r=n||64,i=t||250;if(!e||e.length<2||!i||!r)throw new Error("Terraformer: missing parameter for Terraformer.Circle");o(this,new M({type:"Feature",geometry:P(e,i,r),properties:{radius:i,center:e,steps:r}})),this.__defineGetter__("bbox",function(){return a(this)}),this.__defineGetter__("radius",function(){return this.properties.radius}),this.__defineSetter__("radius",function(e){this.properties.radius=e,this.recalculate()}),this.__defineGetter__("steps",function(){return this.properties.steps}),this.__defineSetter__("steps",function(e){this.properties.steps=e,this.recalculate()}),this.__defineGetter__("center",function(){return this.properties.center}),this.__defineSetter__("center",function(e){this.properties.center=e,this.recalculate()})}var e={},t=6378137,n=57.29577951308232,r=.017453292519943,i={type:"link",properties:{href:"http://spatialreference.org/ref/sr-org/6928/ogcwkt/",type:"ogcwkt"}},s={type:"link",properties:{href:"http://spatialreference.org/ref/epsg/4326/ogcwkt/",type:"ogcwkt"}},x=["length"];return T.prototype={toMercator:function(){return E(this)},toGeographic:function(){return S(this)},toJSON:function(){var e={};for(var t in this)this.hasOwnProperty(t)&&this[t]&&x.indexOf(t)&&(e[t]=this[t]);return e},toJson:function(){return JSON.stringify(this)}},N.prototype=new T,N.prototype.constructor=N,C.prototype=new T,C.prototype.constructor=C,C.prototype.forEach=function(e){for(var t=0;t<this.length;t++)e.apply(this,[this.coordinates[t],t,this.coordinates]);return this},C.prototype.addPoint=function(e){return this.coordinates.push(e),this},C.prototype.insertPoint=function(e,t){return this.coordinates.splice(t,0,e),this},C.prototype.removePoint=function(e){return typeof e=="number"?this.coordinates.splice(e,1):this.coordinates.splice(this.coordinates.indexOf(e),1),this},k.prototype=new T,k.prototype.constructor=k,k.prototype.addVertex=function(e){return this.coordinates.push(e),this},k.prototype.insertVertex=function(e,t){return this.coordinates.splice(t,0,e),this},k.prototype.removeVertex=function(e){return this.coordinates.splice(e,1),this},L.prototype=new T,L.prototype.constructor=L,L.prototype.forEach=function(e){for(var t=0;t<this.coordinates.length;t++)e.apply(this,[this.coordinates[t],t,this.coordinates])},A.prototype=new T,A.prototype.constructor=A,A.prototype.addVertex=function(e){return this.coordinates[0].push(e),this},A.prototype.insertVertex=function(e,t){return this.coordinates[0].splice(t,0,e),this},A.prototype.removeVertex=function(e){return this.coordinates[0].splice(e,1),this},O.prototype=new T,O.prototype.constructor=O,O.prototype.forEach=function(e){for(var t=0;t<this.coordinates.length;t++)e.apply(this,[this.coordinates[t],t,this.coordinates])},M.prototype=new T,M.prototype.constructor=M,_.prototype=new T,_.prototype.constructor=_,_.prototype.forEach=function(e){for(var t=0;t<this.features.length;t++)e.apply(this,[this.features[t],t,this.features])},_.prototype.get=function(e){var t;return this.forEach(function(n){console.log(n.id,e),n.id===e&&(t=n)}),t},D.prototype=new T,D.prototype.constructor=D,D.prototype.forEach=function(e){for(var t=0;t<this.geometries.length;t++)e.apply(this,[this.geometries[t],t,this.geometries])},H.prototype=new T,H.prototype.constructor=H,H.prototype.recalculate=function(){return this.geometry=P(this.center,this.radius,this.steps),this},e.Primitive=T,e.Point=N,e.MultiPoint=C,e.LineString=k,e.MultiLineString=L,e.Polygon=A,e.MultiPolygon=O,e.Feature=M,e.FeatureCollection=_,e.GeometryCollection=D,e.Circle=H,e.toMercator=E,e.toGeographic=S,e.Tools={},e.Tools.positionToMercator=b,e.Tools.positionToGeographic=y,e.Tools.applyConverter=w,e.Tools.toMercator=E,e.Tools.toGeographic=S,e.Tools.createCircle=P,e.Tools.calculateBounds=a,e.MercatorCRS=i,e.GeographicCRS=s,e});